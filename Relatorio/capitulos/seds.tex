\chapter{Sistemas a eventos discretos}

Segundo \citeonline[p. 142, tradução do autor]{lafortune} \begin{citacao} Sistemas a eventos discretos (\acs{SED}s) são sistemas dinâmicos com duas características definidoras: seus espaços de estados são discretos e potencialmente infinitos, e sua dinâmica é orientada a eventos, em vez de tempo. (...) Eventos que ocorrem de forma assíncrona (em geral) causam um salto no espaço de estados, de um estado para outro. \end{citacao} A exemplo disso, protocolos de comunicação em redes de computadores são frequentemente modelados por SEDs, como indica a Figura \ref{fig:protocolo_rede}.

\figura{Protocolo para um canal de redes de computadores com erros de bits: lado remetente e (abaixo) destinatário}{
	\includegraphics[width=.9 \textwidth]{figuras/rdt2_0-remetente.png}\\
	\vspace{8mm}
	\includegraphics[width=.6 \textwidth]{figuras/rdt2_0-destinatario.png}
}{fig:protocolo_rede}{KUROSE, J.; ROSS K. \textbf{Redes de computadores e a internet}: uma abordagem top-down. 6. ed. São Paulo: Pearson, 2013}

Na Figura \ref{fig:protocolo_rede}, tem-se representado um protocolo de redes em que há estados de espera e transições que dependem de eventos discretos -- neste caso, procedimentos computacionais. A representação supracitada é uma evidência do caráter de SED do protocolo, e a figura é um diagrama de estados, que será introduzido mais adiante.

\hl{...}

SEDs são comumente representados por redes de Petri e autômatos determinísticos. \hl{falar um pouco sobre redes de Petri}. Este trabalho de conclusão de concurso, todavia, enfoca a representação por autômatos determinísticos, que podem ser finitos ou infinitos. A diferença entre eles é que naqueles os conjuntos de estados e eventos são finitos e nestes, infinitos. A seção que segue introduz os principais conceitos de autômatos finitos determinísticos usados para este trabalho.

\section{Autômatos finitos determinísticos}

Autômato -- palavra derivada do termo em latim \textit{automatu} -- é ``maquinismo que se move por meios mecânicos'' e ``(...) imita os movimentos humanos'' \cite[p. 81]{aurelio}. Esse termo tem sido usado na Ciência da Computação desde a década de 1930 para descrever importantes modelos da Teoria dos Autômatos, que aborda máquinas de Turing, por exemplo. Nesse contexto, um autômato é uma máquina abstrata descrita matematicamente e idealizada em termos de limitações físicas \cite{hopcroft}.

Um autômato finito determinístico (\acs{AFD}), ou máquina de estados finitos determinística, é uma máquina dotada de fita, unidade de controle e função de transição. A fita de um autômato é um espaço ilimitado utilizado para armazenar uma sequência de símbolos que serão lidos e computados. Já a unidade de controle contém as variáveis do estado atual da máquina, que servem de parâmetro para a computação da função de transição. Para determinar o estado de um autômato, há uma cabeça de leitura sobre a fita e um conjunto de elementos abstratos que norteiam a evolução do funcionamento da máquina: os estados \cite{hopcroft}. A Figura \ref{fig:afd_componentes} esquematiza a transição de estado de um AFD com a cabeça de leitura inicialmente posicionada sobre a segunda célula da fita.

\figuradoautor{Transição de um AFD}{
    \begin{tikzpicture}
        \draw[draw=black] (0,0.8) rectangle ++(0.8,0.8)
        (0.8,0.8) rectangle ++(0.8,0.8)
        (1.6,0.8) rectangle ++(0.8,0.8)
        (2.4,0.8) rectangle ++(0.8,0.8)
        (3.2,0.8) rectangle ++(0.8,0.8)
        (4.8,0.8) rectangle ++(0.8,0.8)
        (5.6,0.8) rectangle ++(0.8,0.8);
        \draw[>=triangle 60,->,line width=0.6mm] (1.2,0.4) -- (1.2,0.7);
        \node at (1.2,0) {estado $q$};
        \node at (0.4,1.2) {$a_1$};
        \node at (1.2,1.2) {$a_2$};
        \node at (2.0,1.2) {$a_3$};
        \node at (2.8,1.2) {$a_4$};
        \node at (3.6,1.2) {$a_5$};
        \node at (4.4,1.2) {$...$};
        \node at (5.2,1.2) {$a_n$};
        
        \draw[>=triangle 60,->,line width=0.4mm, draw=gray] (6.6,1.2) -- (7.8,1.2);
        
        \draw[draw=black] (8,0.8) rectangle ++(0.8,0.8)
        (8.8,0.8) rectangle ++(0.8,0.8)
        (9.6,0.8) rectangle ++(0.8,0.8)
        (10.4,0.8) rectangle ++(0.8,0.8)
        (11.2,0.8) rectangle ++(0.8,0.8)
        (12.8,0.8) rectangle ++(0.8,0.8)
        (13.6,0.8) rectangle ++(0.8,0.8);
        \draw[>=triangle 60,->,line width=0.6mm] (10.0,0.4) -- (10.0,0.7);
        \node at (10.0,0) {estado $q'$};
        \node at (8.4,1.2) {$a_1$};
        \node at (9.2,1.2) {$a_2$};
        \node at (10.0,1.2) {$a_3$};
        \node at (10.8,1.2) {$a_4$};
        \node at (11.6,1.2) {$a_5$};
        \node at (12.4,1.2) {$...$};
        \node at (13.2,1.2) {$a_n$};
    \end{tikzpicture}
}{fig:afd_componentes}

Durante a computação de uma cadeia de entrada, o AFD lê o símbolo da célula atual da fita, apontada pela cabeça de leitura, e avança o cabeçote em uma posição para a direita. Inicialmente, ao receber uma entrada, a cabeça de leitura estará posicionada na extremidade esquerda da fita e, por conseguinte, da cadeia de símbolos. Se a computação de um símbolo lido não acarretar um estado definido ou a cabeça de leitura estiver posicionada sobre uma célula vazia, o funcionamento do autômato será interrompido.

Na Ciência da Computação, os AFDs formam a base de alguns componentes de software e partes de compiladores. Um artifício muito empregado no desenvolvimento de software são as expressões regulares, que podem ser convertidas em AFDs e permitem encontrar padrões em textos \cite{hopcroft}. Já no contexto dos \acs{SED}s, os AFDs são modelos matemáticos que descrevem sistemas com base nos eventos que podem ocorrer. Dessa maneira, as cadeias de símbolos que são enviadas à entrada dos AFDs constituem sequências de eventos cuja computação resulta em uma descrição do sistema baseada nas variáveis de controle da máquina de estados \cite{cassandras}.

\subsection{Definição formal}

A definição de \acs{AFD} que segue foi inspirada e adptada de \citeonline{hopcroft} e \citeonline{cassandras}.

Um AFD $G$ é uma quíntupla $$\langle Q, E, \delta, q_0, Q_m \rangle$$ em que \begin{itemize}[label={}]
  \item $Q$ é o conjunto finito de estados
  \item $E$ é o conjunto finito de eventos
  \item $\delta:Q \times E \nrightarrow Q$ é a função de transição
  \item $q_0 $ é o estado inicial
  \item $Q_m \subseteq Q$ é o conjunto de estados marcados
\end{itemize}

A função de eventos ativos de $G$, que será denotada por $\Gamma_G:Q \rightarrow 2^E$, relaciona cada estado com os eventos possíveis a partir dele. Formalmente $$(\forall q \in Q) (\forall e \in E), e \in \Gamma_G(q) \Leftrightarrow \delta(q, e) \in Q$$ isto é, $e \in \Gamma_G(q)$ se e somente se $\delta(q, e)$ é definido.

Ao fecho de Kleene sobre um conjunto de eventos $E$, denotado por $E^\star$, pertencem todas as possíveis cadeias de eventos pertencentes a $E$. Uma cadeia de eventos é uma sequência finita $e_1 e_2 ... e_{|w|}$ em que $e_i \in E$ ($\forall i = 1..|w|$). Quando $|w| = 0$, a cadeia é dita vazia e será simbolizada por $\varepsilon$.

A função de transição estendida $\hat{\delta}:Q \times E^\star \nrightarrow Q$ é definida recursivamente destarte: $$\hat{\delta}(q, w) = \begin{cases}
q & se$ $w=\varepsilon \\
\hat{\delta}(\delta(q, e), w') & se$ $w=e w'
\end{cases}$$ e terá valor indefinido quando $\delta(q, e)$ assim for.

\subsection{Diagrama de estados}

Para auxiliar na visualização das transições entre os estados dos autômatos, os AFDs são comumente representados por diagramas de estados. Nessa representação, os estados são nós de uma estrutura semelhante a de grafos, e as transições, arestas que interligam dois nós, conforme a Figura \ref{fig:afd_diagrama}. Representam-se as transições cuja origem e destino são o mesmo estado por \textit{loops}: arestas que partem de um nó e terminam no mesmo.

\figuradoautor{Representação da transição de estados em um diagrama}{
    \begin{tikzpicture}[shorten >=1pt,node distance=2cm,on grid,auto] 
        \node[state,minimum size=1.7cm] (q0) {$q$}; 
        \node[state,accepting,minimum size=1.7cm] at (4,0) (q1) {$\delta(q, e)$};
        \draw
        (q0) edge node{$e$} (q1);
    \end{tikzpicture}
}{fig:afd_diagrama}

Nesta classe de diagramas, os estados inicial e final podem ser destacados de alguma forma. Para este trabalho, uma seta sem origem aponta sempre para o nó do estado inicial, e uma circunferência dupla enfatiza o de um estado final, como demonstra a Figura \ref{fig:afd_estado_inicial}.

\figuradoautor{Representação de estados inicial (à esquerda) e final (à direita) em um diagrama}{
    \begin{tikzpicture}[shorten >=1pt,node distance=2cm,on grid,auto] 
        \node[state,initial,minimum size=3cm] (q0) {estado inicial};
        \node[state,accepting,minimum size=3cm] at (4,0) (qf) {estado final};
    \end{tikzpicture}
}{fig:afd_estado_inicial}

Pode-se citar outros aspectos desta representação de autômatos: a possibilidade de adicionar rótulos aos nós, a opção de omitir os nomes dos estados nos nós quando não forem necessários e a aglutinação de transições que partem e terminam no mesmo estado em uma mesma aresta, com os símbolos neste trabalho separados por vírgula.

\subsection{Linguagem marcada}

A linguagem marcada por um AFD $G$ é o conjunto $$L_m(G) = \{ w \in E^\star \mid \hat{\delta}(q_0, w) \in Q_m \}$$ Sendo assim, a linguagem marcada pelo autômato são todas as cadeias de eventos que o fazem transicionar do estado inicial a um estado marcado. Isso significa que, quando uma cadeia $w \in L_m(G)$ for posicionada na fita do autômato, a computação de cada evento, da esquerda para a direita da sequência, sempre resultará em um estado definido e terminará em um estado marcado.

Denomina-se linguagem regular a linguagem marcada por qualquer AFD \cite{hopcroft}. Desse modo, este trabalho de conclusão de curso versará sobre linguagens exclusivamente regulares, a exemplo das quais é possível citar o conjunto dos números naturais pares. Sabendo que um número par é aquele cujo último algarismo -- da esquerda para a direita -- pertence a $\{ 0, 2, 4, 6, 8 \}$, pode-se construir o AFD da Figura \ref{fig:afd_pares}, demonstrando a validade da afirmação.

\figuradoautor{Diagrama de estados do AFD que reconhece números naturais pares}{
    \begin{tikzpicture}[shorten >=1pt,node distance=2cm,on grid,auto] 
        \node[state,initial] (q0) {}; 
        \node[state,accepting] at (5,0) (q1) {};
        \draw
            (q0) edge[loop above] node{$1$, $3$, $5$, $7$, $9$} (q0)
            (q0) edge[bend left, above] node{$0$, $2$, $4$, $6$, $8$} (q1)
            (q1) edge[loop above] node{$0$, $2$, $4$, $6$, $8$} (q1)
            (q1) edge[bend left, below] node{$1$, $3$, $5$, $7$, $9$} (q0);
    \end{tikzpicture}
}{fig:afd_pares}

Quando um autômato se destina a verificar padrões em cadeias de eventos, ou palavras, diz-se que ele é um formalismo reconhecedor \cite{menezes} e, portanto, o autômato da Figura \ref{fig:afd_pares} reconhece todos os números naturais pares. No que tange aos \acs{SED}s, \citeonline{cassandras} \hl{...}

\subsection{Linguagem gerada e bloqueios}

A linguagem gerada por um AFD $G$ é o conjunto $$L(G) = \{ w \in E^\star \mid \hat{\delta}(q_0, w) \in Q \}$$ Neste caso, a linguagem são todas as cadeias de eventos que fazem o autômato transicionar do estado inicial a um estado definido.

Caso o autômato $G$ chegue a um estado $q \not\in Q_m$ tal que $\Gamma_G(q) = \varnothing$, diz-se que há um \textit{deadlock}. Um \textit{livelock} se configura quando não é possível alcançar, a partir de um estado a que se chegou, um estado marcado. Se qualquer bloqueio acontece, tem-se que $$\overline{L_m(G)} \subset L(G)$$ em que $\overline{L_m(G)}$ é o conjunto de todos os prefixos de todas as cadeias pertencentes a $L_m(G)$, ou $$\overline{L_m(G)} = \{ w \in E^\star \mid \exists w' \in E^\star, w w' \in L_m(G) \}$$ Isso é devido a \hl{...} \cite{cassandras}.

\subsection{Função de transição total}

Haja vista que não é possível formular funções parciais no assistente de provas Coq, algumas mudanças na definição de AFD supracitada são necessárias a fim de representar AFDs nessa ferramenta. A começar, é impreterível alterar a função de transição de um AFD $G$ para torná-la total. Seja $\delta' : Q \cup \{ \otimes \} \times E \rightarrow Q \cup \{ \otimes \}$ a seguinte função total: $$\delta'(q, e) = \begin{cases}
\delta(q, e) & se$ $q \in Q \wedge \delta(q, e) \in Q \\
\otimes & se$ $q \not\in Q \vee \delta(q, e) \not\in Q
\end{cases}$$ em que $\otimes$ é um estado novo, não pertencente a $Q$: o estado de ralo.

O autômato $G$ é muito semelhante ao $$G' = \langle Q \cup \{ \otimes \}, E, \delta', q_0, Q_m \rangle$$ uma vez que a única diferença entre eles é que, em $G'$, ao realizar-se uma transição que seria indefinida em $G$, alcança-se um estado do qual não se pode sair.

Como a função $\delta'$ é total, tem-se que $$L(G') = E^\star$$ em termos do que se estabeleceu como linguagem gerada anteriormente. Pode-se, não obstante, modificar a definição dela de forma que $G$ e $G'$ sejam equivalentes em se tratando de linguagens: $$L'(G') = \{ w \in E^\star \mid \hat{\delta}(q_0, w) \in Q \wedge \hat{\delta}(q_0, w) \neq \otimes \}$$ é a linguagem gerada pelo autômato $G'$. Então $$L'(G') = L'(G) = L(G)$$

É possível visualizar as formulações de um AFD usando função de transição parcial e total na Figura \ref{fig:afd_funcao_total}, que a exemplifica para um AFD de alfabeto $\{ a, b \}$.

\figuradoautor{Um AFD simples (à esquerda) e seu correspondente com função de transição total (à direita)}{
	\raisebox{-0.5\height}{\begin{tikzpicture}[shorten >=1pt,node distance=2cm,on grid,auto] 
	\node[state,initial,accepting] (q0) {$q_0$}; 
	\node[state] at (3,0) (q1) {$q_1$};
	\draw
	(q0) edge[bend left, above] node{$a$} (q1)
	(q1) edge[bend left, below] node{$b$} (q0);
	\end{tikzpicture}}
	\raisebox{-0.5\height}{\begin{tikzpicture}[shorten >=1pt,node distance=2cm,on grid,auto] 
	\node[state,initial,accepting] at (0, 2) (q0) {$q_0$}; 
	\node[state] at (3,2) (q1) {$q_1$};
	\node[state] at (1.5,0) (q2) {$\otimes$};
	\draw
	(q0) edge[bend left, above] node{$a$} (q1)
	(q0) edge[bend right, below] node{$b$} (q2)
	(q1) edge[bend left, below] node{$a$} (q2)
	(q1) edge[bend left, below] node{$b$} (q0)
	(q2) edge[loop below] node{$a$, $b$} (q2);
	\end{tikzpicture}}
}{fig:afd_funcao_total}

\hl{E OS BLOQUEIOS?}

É evidente que um AFD cuja função de transição não é total pode ser modelado matematicamente utilizando funções totais. Isso é importante para que se possa representá-lo na linguagem do Coq.

